# UR3 simulator
**This documentation is based on the [The URScript Programming Language](https://s3-eu-west-1.amazonaws.com/ur-support-site/32554/scriptManual-3.5.4.pdf) Version 3.5.4**
<!--19/07/2020-->

The programming language of the UR3 is called **URScript**, there are two ways to program the robot in this language:

+ Using the PolyScope interface of the robot to submit a file with URScript code.
+ Sending *programs* or *commands* to the TCP/IP socket of the robot.

The service responsible of executing the URScript is the **URControl** that is running inside the Mini-ITX PC of the robot.

## TCP/IP connection
In order to be able to connect to the TCP/IP socket of the URControl software, the **Ethernet port** of the robot must be connected to a network and the robot must have the network connection enable (see the robot [user manual](https://www.cfzcobots.com/wp-content/uploads/2017/03/ur3_user_manual_es_global.pdf) for more info about this).

Once the robot has the TCP/IP socket enable, the address is:

+ **hostname**: ur-xx or the IP address
+ **ports**: 30002

## Program and Commands format
1. The program or Command must contain only [extendend ASCII](https://theasciicode.com.ar/) characters.
2. The block of code inside an **environment** (eg. *if*, *while*, *def*, *sec*, *thread*, ...) must be properly idented
3. each environment must be finished with *end*

## Fundamental data types
+ *none*
+ *bool*
+ *number* (int or float)
+ *pose*, a literal of this type is defined as `p[x,y,z,ax,ay,az]` were `x,y,z` are positional numbers and `ax,ay,az` are angular numbers.
+ *string*

## Expressiones
### arithmetic expressions
```
1+2-3
4*5/6
(1+2)*3/(4-5)
```
### boolean expressions
```
True or False and (1 == 2)
1 > 2 or 3 != 4 xor 5 < -6
not 42 >= 87 and 87 <= 42
```
## Variable assigment
```
foo = 42
bar = False or True and not False
baz = 87-13/3.1415
hello = "Hello, World!"
l = [1,2,4]
target = p[0.4,0.4,0.0,0.0,3.14159,0.0]
```
a variable can have global or local scope

```
global x = 1
def p_x_y():
    local y = 2
    x = x+y
end
assert(x == 3)
```

## Statements
### if statement
```
if a > 3:
    a = a + 1
elif b < 7:
    b = b * a
else:
    a = a + b
end
```
### while statement
```
l = [1,2,3,4,5]
i = 0
while i < 5:
    if l[i] == 2:
        l[i] = l[i]*2
        continue
    elif i>3:
        l[i] = l[i]+1
    elif i>10:
        break
    end
    i = i + 1
end
```
## Functions, RPC and Threads

### Functions
```
def myProg()
    a = [50,100]
    fun(a)

    def fun(p1):
        p1[0] = 25
        assert(p1[0] == 25)
        ...
    end
    assert(a[0] == 50)
    ...
end
```
### Remote Procedure Call (RPC)
This are similar to normal function calls, except that the
function is defined and executed remotely. The controller uses the *XMLRPC standard* to send the parameters to the remote site and retrieve the result(s).
```
...
camera = rpc_factory("xmlrpc", "http://127.0.0.1/RPC2")
if (! camera.initialize("RGB")):
popup("Camera was not initialized")
camera.takeSnapshot()
target = camera.getTarget()
...
```

### Threads
```
thread myThread():
    ...
    # Code
    ...
    enter_critical
    # When execute this, always finish
    exit_critical
    ...
    return False
end

thrd = run myThread()
kth = False
if kth:
    kill thrd #Kill the thread
else:
    join thrd #Wait the thread to finish
```
threads has special considerations:
+  a thread cannot take any parameters
+  although a return statement is allowed in the thread, the value returned is discarded and cannot be accessed from outside the thread.
+ a thread can contain others threads.

## Program label
Program label code lines, with an `$` as first symbol, are special lines in programs generated by PolyScope that make it possible to track the execution of a program.

```
...
$ 2 "var_1= True "
global var_1= True
...
```

## Modules
the modules are various types of functions sorted by task, that can be used in URScript. There are four modules:
+ motion
+ internals
+ urmath
+ interfaces

to see the complete list of functions in each module refer to **The URScript Programming Language**